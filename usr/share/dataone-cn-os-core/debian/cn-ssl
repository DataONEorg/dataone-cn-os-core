<IfModule mod_ssl.c>
<VirtualHost *:443>
	DocumentRoot /var/www
	ServerName SERVER_NAME
	ServerAlias SERVER_ALIAS
	
	DirectoryIndex listObjects.xml
    
    ## Allow CORS requests from all origins to use cookies
    SetEnvIf Origin "^(.*)$" ORIGIN_DOMAIN=$1
    Header set Access-Control-Allow-Origin "%{ORIGIN_DOMAIN}e" env=ORIGIN_DOMAIN
    Header set Access-Control-Allow-Credentials "true"
    
    ## Allow annotator authentication token on the header
	Header set Access-Control-Allow-Headers "Authorization, Content-Type, Location, Content-Length"
	Header set Access-Control-Expose-Headers "Content-Length, Content-Type, Location"
	Header set Access-Control-Allow-Methods: "POST, GET, OPTIONS, PUT, DELETE"
    
	<Directory /var/www/>
		Options Indexes FollowSymLinks MultiViews
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>
	
	RewriteEngine On
	SSLProxyEngine On
    RewriteOptions Inherit
    
   <Location /metacat/metacat>
        Order allow,deny
        Allow from 127.0.0.0/8 ::1
    </Location>
    <Location /metacat/servlet/metacat>
        Order allow,deny
        Allow from 127.0.0.0/8 ::1
    </Location>
    <Location /metacat/d1/mn>
        Order allow,deny
        Allow from 127.0.0.0/8 ::1
    </Location>


	Include /etc/apache2/jk_mount	
	AllowEncodedSlashes On
	AcceptPathInfo On
	<Location /metacat/servlet/replication>
	  SSLVerifyClient require
	  SSLVerifyDepth  10
	</Location>

	#   SSL Engine Switch:
	#   Enable/Disable SSL for this virtual host.
	SSLEngine on
	SSLOptions +StrictRequire +StdEnvVars +ExportCertData        
	SSLVerifyClient optional
	SSLVerifyDepth 10

	SSLCertificateFile /etc/ssl/certs/PUBLIC_SERVER_CERT
	SSLCertificateKeyFile /etc/ssl/private/D1_PRIVATEKEY_FILE
	SSLCertificateChainFile /etc/ssl/certs/INTERMEDIATE_BUNDLE
	
	SSLCACertificateFile /etc/ssl/certs/D1_CHAIN_FILE

</VirtualHost>

<VirtualHost *:80>
        DocumentRoot /var/www
        ServerName SERVER_NAME

        Redirect permanent / https://SERVER_NAME/
</VirtualHost>

</IfModule>

